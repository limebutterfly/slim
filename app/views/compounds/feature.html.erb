<p id="notice"><%= notice %></p>

<h1>Feature <%= @compound %></h1>
<hr />
<p>
  <%
     if @compound =~/(\d+\.\d+)_(\d+\.\d+)n/
  %><br /><strong>Retention time:</strong> <%=(@idents.count ? "%.6f"%@idents.take.retention_time : "%.2f"%$1)%><br /><strong>Neutral mass:</strong> <%="%.4f"%$2%>
  <% end
     if @compound =~/(\d+\.\d+)_(\d+\.\d+)m\/z/
  %><br /><strong>Retention time:</strong> <%=(@idents.count ? "%.6f"%@idents.take.retention_time : "%.2f"%$1)%><br /><strong>Mass:</strong> <%="%.4f"%$2%> m/z
  <% end %>
</p>

<h3>Feature identification</h3>
<% if @idents.count == 0
     %><p>No identification data found</p>
    <% else %>
<table><tr><th>Result-ID</th><th>Lipid</th><th>Lipid mass</th><th>Score</th><th>Frag. score</th><th>Mass error</th><th>Isotope sim.</th></tr>
  <% @idents.each do |compound|%>
      <tr>
        <td><%= link_to compound.compound_id, compound_path(compound) %></td>
        <td><%= link_to compound.description, lipid_path(compound.lipid) %></td>
        <td><%= compound.lipid.exact_mass %></td>
        <td><%= "%02.1f"%compound.score %></td>
        <td><%= "%02.1f"%compound.fragmentation_score %></td>
        <td><%= "%.4f"%compound.mass_error %></td>
        <td><%= "%02.4f"%compound.isotope_similarity %></td>
      </tr>

  <% end %>
</table>
    <% end %>

<h3>Feature quantification</h3>

<%
   if not @quants.nil?
%>
    <table style="width:500px">
      <tr><th>Sample</th><th>Raw value</th><th>Normalized value</th></tr>
      <%
         @quants.each do |key, values|
           values[0] = values[0].to_i
           values[1] = values[1].to_i
           raw = 255*(values[0]-@raw_min)/@raw_max
           norm = 255*(values[1]-@norm_min)/@norm_max
      %>
          <tr><td><%=key.gsub(/_/," ")%></td><td style="text-align:right;background-color:#<%="%02x%02x%02x"%[raw>127.5 ? (255-raw)*2 : 255,255-((127.5-raw).abs)*2,raw<127.5 ? raw*2 : 255] %>"><%="%.0f"%values[0]%></td><td style="text-align:right;background-color:#<%="%02x%02x%02x"%[norm>127.5 ? (255-norm)*2 : 255,255-((127.5-norm).abs)*2,norm<127.5 ? norm*2 : 255] %>"><%="%.0f"%values[1]%></td></tr>
      <%
         end
      %>

    </table>
<%
   else
%>
    <p>No quantification data found.</p>
<%
   end%>