<h1>Results of feature filtering</h1>
<hr />
<%=render file: 'compounds/show_filtering_criteria'%>

<p class="text-warning">filtered <%= @results.length %> lipids (<%="%02.1f"%(100*@results.length/Feature.count) %>%) out of  <%= Feature.count %> identifications.</p>
<%= form_tag(:controller => 'filter',:action => 'csv') do %>
    <%= button_to 'Export as csv','csv' %>
<% end %>
<hr />
<table class="table table-condensed table-striped">
  <thead>
  <tr>
    <th colspan="3"></th>
    <th colspan="<%=@samples.count%>" class="bg-warning">Raw Values</th>
    <th colspan="<%=@samples.count%>" class="bg-info">Normalized Values</th>
  </tr>
  <tr>
    <th>Feature</th>
    <th>Lipid</th>
    <th># Ident</th>
    <% @samples.each do |id, name| %>
        <th class="bg-warning"><%=name%></th>
    <% end %>
    <% @samples.each do |id, name| %>
        <th class="bg-info"><%=name%></th>
    <% end %>
  </tr>
  </thead>

  <tbody>
  <% @results.each do |identification| %>
      <tr>
        <td><%= link_to identification.feature.id_string, feature_path(identification.feature) %></td>
        <td><%= link_to identification.lipid.common_name, lipid_path(identification.lipid) %></td>
        <td><%= Identification.where(feature: identification.feature).count %></td>
        <% norm = []
           identification.feature.quants.each do |id, value|
            norm << "%.0f"%value[1]
        %>
        <td><%="%.0f"%value[0]%></td>
        <% end
        norm.each do |value|
        %>
        <td><%=value%></td>
        <% end %>
      </tr>
  <%end%>
  </tbody>
</table>